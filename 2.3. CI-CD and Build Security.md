<p align="left">November 4, 2024 - Hey there, fellow lifelong learner!<br>
I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure. It´s part of my $$\textcolor{#FF69B4}{\textbf{182}}$$-day-streak in  <a href="https://tryhackme.com/r/p/Rosana">TryHackMe</a>.</p>


<h3 align="center"> $$\textcolor{white}{\textnormal{DevSecOps Learning Path - 2nd Module}}$$ </h3>
<h1 align="center"> $$\textcolor{white}{\textnormal{CI-CD and Build Security}}$$ </h1>
<p align="center">Learn about CI/CD and build principles to safeguard your pipelines. <a href="https://tryhackme.com/r/room/cicdandbuildsecurity">CI/CD and Build Security</a>.</p><br>
<p align="center">
  <img height="150px" hspace="20" src="https://github.com/user-attachments/assets/b99b2c7e-c4e6-4e89-b18c-692108f7f141">
  <img height="150px" src="https://github.com/user-attachments/assets/fed9a6ae-94c3-4254-9e61-d6501f10d733">
</p>

<h2><p align="center">Summary<a id='0'></a></h2>

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Introduction](#1) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [Setting up](#2) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [What is CI/CD and Build Security?](#3)  &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [Creating you own Pipeline](#4)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Securing the Build Source](#5) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [Securing the Build Process](#6) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [Securing the Build Server](#7)  &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp;  [Securing the Build Pipeline](#8) <br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [Securing the Build Environment](#9) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp;[Securing the Build Secrets](#10) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [Conclusion](#11) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [Room Complete](#12) &nbsp;&nbsp;&nbsp;▪️&nbsp;&nbsp;&nbsp; [My Journey](#13) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;




<h2>Task 1. Introduction<a id='1'></a></h2>

<p align="center">
  <img width="800px" src="https://github.com/user-attachments/assets/52a68dad-760b-42e7-b998-7b6f654bd868">
</p>

<p>Welcome to the CI/CD and Build Security network! In this room, we will explore what it takes to secure a DevOps pipeline and the builds it produces. Understanding the potential risks and consequences of insecure build processes is essential for recognising the urgency of implementing robust security measures. In this network, we will explore common insecurities and how threat actors can exploit these to compromise not only the process, but also production systems!</p>

<h3>Pre-Requisites</h3>
<p><ul style="list-style-type:square">
    <li>SDLC</li>
    <li>SSDLC</li>
    <li>Intro to Pipeline Automation</li>
    <li>Dependency Management</li>
</ul></p>

<h3>Learning Objectives</h3>
<p><ul style="list-style-type:square">
    <li>Understand the significance of CI/CD and build system security within the DevSecOps pipeline.</li>
    <li>Explore the potential risks and consequences associated with insecure CI/CD pipelines and build processes.</li>
    <li>Gain awareness of the importance of integrating robust security measures into the build processes to ensure integrity with the deployment of applications.</li>
    <li>Learn about the practical attacks that can happen against misconfigured CI/CD pipelines and build processes.</li>
</ul></p>

<h3 align="left"> $$\textcolor{#a8ec2c}{\textnormal{Answer the question below}}$$ </h3>

> 1.1. <em>I'm ready to learn about CI/CD and Build Security!</em><br><a id='1.1'></a>
>> <code><strong>No answer needed</strong></code>
<br>

<h2>Task 2. Setting up<a id='2'></a></h2>

<h3>Patching In</h3>

<h3>Configuring DNS</h3>

<h3>Contactting MU-TH-UR 6000</h3>

<h3 align="left"> $$\textcolor{#a8ec2c}{\textnormal{Answer the questions below}}$$ </h3>

> 2.1. <em>I am ready to start my CI/CD and Build security learning journey.</em><br><a id='2.1'></a>
>> <code><strong>No answer needed</strong></code>
<br>

> 2.2. <em>I am connected to the network using my preferred method of choice and can confirm that I can access the Gitlab server.</em><br><a id='2.2'></a>
>> <code><strong>No answer needed</strong></code>
<br>

> 2.3. <em>I have registered an account with Mother..</em><br><a id='2.2'></a>
>> <code><strong>No answer needed</strong></code>
<br>

<h2>Task 3. What is CI/CD and Build Security?<a id='3'></a></h2>

<h3>Introduction</h3>

<h3>Fundamentals of CI/CD</h3>

<h3>A Typical CI/CD Pipeline</h3>

<h3>SolarWinds Case</h3>

<h4>Implement Isolation and Segmentation Techniques</h4>

<h4>Set Up Appropriate Access Controls and Permissions</h4>

<h4>A note on Network Security</h4>

<h3 align="left"> $$\textcolor{#a8ec2c}{\textnormal{Answer the questions below}}$$ </h3>

> 3.1. <em>What element of a CI/CD pipeline coordinates and manages the automation of build and deployment environments?.</em><br><a id='3.1'></a>
>> <code><strong>build orchestrator</strong></code>
<br>

> 3.2. <em>What element of a CI/CD pipeline builds, tests, and packages code?</em><br><a id='3.2'></a>
>> <code><strong>build agents</strong></code>
<br>

> 3.3. <em>What fundamental of CI/CD promotes developers in having access to the latest builds and code in order to understand and see the changes that have been made?</em><br><a id='3.3'></a>
>> <code><strong>maximum visibility</strong></code>
<br>

<h2>Task 4. Creating you own Pipeline<a id='4'></a></h2>

<h3>Introduction</h3>

<h3>Gitlab Registration</h3>

<h3>Project Creation</h3>

<h3>Understanding CI/CD Configuration</h3>

<h4>Stages</h4>

<h4>Tests</h4>

<h4>Deployment</h4>

<h3>Runner Registration</h3>

<h3>Build Automation</h3>

<h3 align="left"> $$\textcolor{#a8ec2c}{\textnormal{Answer the questions below}}$$ </h3>

> 4.1. <em>What element of a CI/CD pipeline coordinates and manages the automation of build and deployment environments?</em><br><a id='4.1'></a>
>> <code><strong>Gitlab Runner</strong></code>
<br>

> 4.2. <em>What element of a CI/CD pipeline builds, tests, and packages code?</em><br><a id='4.2'></a>
>> <code><strong>THM{Welcome.to.CICD.Pipelines}</strong></code>
<br>

<h2>Task 5. Securing the Build Source<a id='5'></a></h2>

<h3>Source Code Security</h3>
<p>As mentioned in the Introduction to Pipeline Automation and Source Code Security rooms, the first step to securing the pipeline and the build is to secure the source. In the event that a threat actor can compromise the source of our build, they are in a position to compromise the build itself. We want to protect our source code from the following two main issues:</p>
<p><ul style="list-style-type:square">
    <li><strong>Unauthorised Tampering</strong>strong> - This is the simplest issue of the two. Only authorised users should be able to make changes to the source code. This means that we want to control who has the ability to push new code to our repo.</li>
    <li><strong>Unauthorised Disclosure</strong> - This is a bit more tricky. Depending on the application, the source code itself might be considered sensitive. For example, Microsoft would not like to disclose the source code of Word since that is their intellectual property. In cases where the source code is sensitive, we must ensure we do not intentionally disclose it. This issue is a lot more common to find.</li>
</ul></p>

<h3>Confusion of responsibilities</h3>
<p>Let's take a look at exploiting an insecure build source. A common mistake made in large organisations is believing that the perimeter is a sufficient security boundary. Although the perimeter plays a role, it should not be seen as the only boundary. Granular access control on the internal network should be implemented as well. This false belief can lead to interesting misconfigurations. Let's take a look at a practical example.<br>

Some organisations are incredibly large and have multiple teams and business units responsible for different things. If we take an organisation such as a bank, many different teams and units work together to run the bank. Furthermore, in large organisations like this, it isn't as simple as just saying that we have an "IT" business unit, as there may be several teams working on many different IT and development projects within the bank, using a wide range of coding languages, CI/CD pipelines, and build frameworks. Such large organisations may choose to host their source code internally since much of that development may be intellectual property (IP). While we would hope that access to the various source code repos would be managed granularly, mistakes do creep in.<br>

One such mistake is that organisations can leave registration for their Gitlab instance open. Not open to the internet (although this has also happened before), but open to any user on their internal network to register a profile. This was simulated in the previous task by allowing you to register your own Gitlab profile.<br>

Some would consider this not to be a direct risk, but let's look at how the attack surface grows. Our example bank organisation might have 10,000 employees, of which 2000 may be working as developers and need access to Gitlab. In essence, our attack surface has grown by 500%! If a single employee of our bank is compromised, an attacker would have the ability to register a profile and exfiltrate any publicly shared repos.<br>

This is the second misconfiguration that comes into play. Developers of our bank may believe that because the Gitlab instance is only accessible internally, it is okay to configure repos to be shared publicly. This means that any user who has a valid Gitlab account will be able to view the repo. While they may perhaps not be able to alter the code, remember, in this example, the code itself is seen as the IP of the bank. This confusion between who is responsible for securing the source code can lead to sensitive information being disclosed to the threat actor. Let's take a look at how this can be exploited!</p>

<h3>Exploiting a vulnerable build source</h3>
<p>You have already registered a profile on the GitLab instance. While you can use manual enumeration to find sensitive information in repos, where you are on a red team, you will need to automate this process to ensure stealth and efficiency. We will not be teaching both in this task for obvious reasons, so let's look at how we can make the process efficient. To efficiently enumerate publicly visible repos, we will make use of the Gitlab API and a Python script as follows:</p>

![image](https://github.com/user-attachments/assets/1bf15757-b826-42fa-9d53-508934d4229e)

<p>Note: Make sure to install the Gitlab pip package using pip3 install python-gitlab==3.15.0.<br>

As mentioned before, the script provided is not stealthy. Rather than first determining which repos are publicly available, it recovers the entire list of all repos and attempts to download each of them. This shows an example of how a threat actor can quickly and easily recover all publicly available repos. Feel free to play around with the script to introduce stealth.<br>
As you will see, line 5 of the script requires a Gitlab authentication token. Gitlab does not allow for its API to be interfaced with using credentials, as this is deemed insecure. Therefore, to use the script, we will first have to generate an API token for our account. Authenticate to the Gitlab server and perform the following steps:</p>

<p> 1.  Click on your profile icon and select Preferences:</p>

![image](https://github.com/user-attachments/assets/ed060429-eec0-44de-9014-f2035a26679e)

<p> 2.  Click on Access Tokens:</p>

![image](https://github.com/user-attachments/assets/4cb9aefa-1b51-4a6d-8f50-2cc2fdef09a9)

<p> 3. Enter a name for a new API token and select the api, read_api, and read_repository scopes:</p>

![image](https://github.com/user-attachments/assets/72fdf196-85b9-4ef1-8095-915dad5dbd40)

<p> 4. Click Create personal access token, reveal, and copy your access token to a safe location:</p>

![image](https://github.com/user-attachments/assets/90dc0d3c-3efc-447a-a40c-7421226885bf)

<p> 5. Add the token to the script and execute it to download all repos:</p>

![image](https://github.com/user-attachments/assets/bdffa6bd-23d0-4b31-ab29-b91e649f6189)

<p>Now you have successfully downloaded all of the publicly available repos! At this point, there are several ways you can look for sensitive information. The easiest would be to extract all repos and run a grep for specific keywords, such as <code>secret</code>. Make sure to read through the available repos to find the hidden secret flag!</p>

<h3>Securing the Build Source</h3>
<p>Granular access control is crucial to managing repositories and the GitLab platform. It involves defining specific permissions and restrictions for different users or groups, ensuring that only authorised individuals have the appropriate level of access to sensitive resources. This helps maintain security, confidentiality, and effective collaboration within a development environment.<br>

In GitLab, group-based access control is a powerful mechanism that simplifies permissions management across multiple repositories and projects. Here's how it works:</p>

<ol type="1. ">
    <li><strong>Group-Based Access Control</strong>: GitLab allows you to organise projects into groups. Instead of managing access for each project separately, you can set permissions at the group level. This means that the same access rules apply to all projects within the group, making it easier to maintain consistent security policies. For example, you can create a group for the development team and define permissions, such as who can view, edit, or contribute to projects within that group. This approach streamlines access management and reduces the chances of errors or oversights when configuring permissions for individual repositories.</li><br>
    <li><strong>Access Levels</strong>: GitLab offers different access levels, such as Guest, Reporter, Developer, Maintainer, and Owner. Each level comes with specific capabilities and permissions. Assigning the appropriate access level to each user or group ensures they have the necessary privileges without granting unnecessary permissions.</li><br>
    <li><strong>Sensitive Information Protection</strong>: One critical consideration is preventing the accidental exposure of sensitive information. GitLab provides features to help with this:</li><br>
         <ol type="1 ">
    <li><strong>GitLab's .gitignore</strong>: This file specifies which files or directories should be excluded from version control. It's crucial for preventing sensitive data like passwords, API keys, and configuration files from being committed to repositories</li><br>
    <li><strong>Environment Variables</strong>: GitLab allows you to define and manage environment variables securely, separate from the source code. This is especially useful for storing sensitive data needed during the CI/CD process without exposing it in the repository.</li><br>
    <li><strong>Branch Protection</strong>: Branches, like master or main, can be protected to prevent direct pushes, ensuring that changes go through code review and automated testing before merging.</li>
          </ol></p><br>
</ol></p>

<p>Remember, maintaining the security of both the repositories and the GitLab instance itself requires constant vigilance and best practices:
<ul style="list-style-type:square">
    <li>Review and update access permissions regularly as team members change roles or leave the organisation.</li>
    <li>Implement two-factor authentication (2FA) to add an extra layer of security to user accounts.</li>
    <li>Monitor audit logs to track who has accessed or modified repositories and projects.</li>
    <li>Regularly scan repositories for sensitive information using tools designed for this purpose.</li>
</ul></p>

<h3 align="left"> $$\textcolor{#a8ec2c}{\textnormal{Answer the questions below}}$$ </h3>

> 5.1. <em>Which file specifies which directories and files should be excluded for version control?</em><br><a id='5.1'></a>
>> <code><strong>.gitignore</strong></code>
<br>

> 5.2. <em>What can you protect to ensure direct pushes and vulnerable code changes are avoided?</em><br><a id='5.2'></a>
>> <code><strong>branches</strong></code>
<br>

> 5.3. <em>What issue does lack of access control and unauthorised code changes lead to?</em><br><a id='5.3'></a>
>> <code><strong>unauthorised tampering</strong></code>
<br>

> 5.4. <em>What is the API key stored within the Mobile application that can be accessed by any Gitlab user??</em><br><a id='5.4'></a>
>> <code><strong>THM{You.Found.The.API.Key}</strong></code>
<br>

<h2>Task 6. Securing the Build Process<a id='6'></a></h2>

<br>

<h2>Task 7. Securing the Build Server<a id='7'></a></h2>

<br>

<h2>Task 8. Securing the Build Pipeline<a id='8></a></h2>

<br>

<h2>Task 9. Securing the Build Environment<a id='9></a></h2>

<br>

<h2>Task 10. Securing the Build Secrets<a id='10></a></h2>

<br>

<h2>Task 11. Conclusion<a id='11></a></h2>

<br>


<h2>Room Complete<a id='12'></a></h2>
<p>Keep learning, keep growing!<br>

<p align="center">
  <img width="1000px" src="https://github.com/user-attachments/assets/ad09c1ab-243a-4a1b-a61c-e76527eab9a1">
  <img width="1000px" src="https://github.com/user-attachments/assets/328bd7ed-c7e6-459c-903e-c52932964716">
</p>


<p></p>

<h2>My Journey<a id='13'></a></h2>
<p></p>Following I share the status of my journey in TryHackMe.</p>

| Date              | Streak   | All Time     | All Time     | Monthly     | Monthly    | Points   | Rooms     |
| :---------------: | :------- | :----------- | :----------- | :---------- | :--------- | :------  | :-------- |
|                   |          | WorldWide    | Brazil       | WorldWide   | Brazil     |          | Completed |
| November 4, 2024  | 182      |       1,353ª |          28ª |      5,245ª |        76ª | 52,718   |       398 |

<br>

![image](https://github.com/user-attachments/assets/753dcae6-e02d-41aa-b6cd-91cf0454ed47)

<p style="text-align: center;">Thank you for coming. Hope to learn together again!!</p>

