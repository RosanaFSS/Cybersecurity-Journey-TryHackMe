<p align="center">March 6,2025</p>
<p align="center">Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure.<br>
It´s part of my $$\textcolor{#FF69B4}{\textbf{304}}$$-day-streak in  <a href="https://tryhackme.com/">TryHackMe</a>.</p>
 
<h1 align="center">
  $$\textcolor{#3bd62d}{\textnormal{Sandbox Evasion}}$$
</h1>
<p align="center">Learn about active defense mechanisms Blue Teamers can deploy to identify adversaries in their environment.</p>
<p align="center">Access this premium (subscribers only) hard-level walkthrough clicking <a href="https://tryhackme.com/room/sandboxevasion">Sandbox Evasion</a>.</p><br>
<p align="center">
  <img height="150px" hspace="20" src="https://github.com/user-attachments/assets/b9c5de72-f65b-4d02-9650-6f416805941e">
  <img height="150px" src="https://github.com/user-attachments/assets/937d48cc-013b-44b6-b07b-5a82d531a711">
</p>

<br>
<h2>Task 1. Introduction</h2>
<br>


<br>
<h4 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the question below}}$$ </h4>
<br>

> 1.1. <em>Read the task above!</em><br><a id='2.1'></a>
>> <code><strong>No answer needed</strong></code>

<br>
<h2>Task 2. An Adversary walks into a Sandbox</h2>
<br>


<br>
<h4 align="left"> $$\textcolor{#f00c17}{\textnormal{Answer the questions below}}$$ </h4>
<br>

> 2.1. <em>Sandboxes are a form of ______ Analysis. Hint : This type of analysis involves running the code.</em><br><a id='2.1'></a>
>> <code><strong>Dynamic</strong></code>

<br>

> 2.2. <em>What type of Sandboxes analyze attachments attached to emails?s</em><br><a id='2.1'></a>
>> <code><strong>Mail Sandbox</strong></code>

<br>
<h2>Task 3. Common Sandbox Evasion Techniques</h2>
<h3>An Introduction to Sandbox Evasion</h3>
<p>Now that you have a general idea of what Malware Sandboxes are, we can move on to learning some evasion techniques at a high level. We will be breaking this down into four different categories; in the next task, we will implement four different evasion techniques (one from each category), so you can leave this room with some practical knowledge to help out in your Red Team operations.<br><br>
We will be covering the following four broad categories:<br>
- Sleeping through Sandboxes<br>
- Geolocation and Geoblocking<br>
- Checking System Information<br>
- Querying Network Information<br><br>
These are ordered from the most basic techniques to the most advanced. Let's get started.</p>

<br>
<h3>Sleeping through Sandboxes</h3>
<p>Malware Sandboxes are often limited to a time constraint to prevent the overallocation of resources, which may increase the Sandboxes queue drastically. This is a crucial aspect that we can abuse; if we know that a Sandbox will only run for five minutes at any given time, we can implement a sleep timer that sleeps for five minutes before our shellcode is executed. This could be done in any number of ways; one common way is to query the current system time and, in a parallel thread, check and see how much time has elapsed. After the five minutes have passed, our program can begin normal execution.<br>

Another popular method is to do complex, compute-heavy math, which may take a certain amount of time — for example, calculating the Fibonacci sequence up to a given number. Remember that it may take more or less time to do so based on the system's hardware. Masking your application is generally a good idea to avoid Anti-Virus detections in general, so this should already be something in your toolkit.<br>

Beware that some sandboxes may alter built-in sleep functions; various Anti-Virus vendors have put out blog posts about bypassing built-in sleep functions. So it is highly recommended you develop your own sleep function. Here are a couple of blog posts about bypassing Sleep functions:<br>

- https://evasions.checkpoint.com/src/Evasions/techniques/timing.html
- https://www.joesecurity.org/blog/660946897093663167</p>

<br>
<h3>Geolocation</h3>
<p>Malware Sandboxes are often limited to a time constraint to prevent the overallocation of resources, which may increase the Sandboxes queue drastically. This is a crucial aspect that we can abuse; if we know that a Sandbox will only run for five minutes at any given time, we can implement a sleep timer that sleeps for five minutes before our shellcode is executed. This could be done in any number of ways; one common way is to query the current system time and, in a parallel thread, check and see how much time has elapsed. After the five minutes have passed, our program can begin normal execution.<br>

Another popular method is to do complex, compute-heavy math, which may take a certain amount of time — for example, calculating the Fibonacci sequence up to a given number. Remember that it may take more or less time to do so based on the system's hardware. Masking your application is generally a good idea to avoid Anti-Virus detections in general, so this should already be something in your toolkit.<br>

Beware that some sandboxes may alter built-in sleep functions; various Anti-Virus vendors have put out blog posts about bypassing built-in sleep functions. So it is highly recommended you develop your own sleep function. Here are a couple of blog posts about bypassing Sleep functions:<br>

- https://evasions.checkpoint.com/src/Evasions/techniques/timing.html<br>
- https://www.joesecurity.org/blog/660946897093663167<br>

IfConfig.me can be used to retrieve your current IP Address, with additional information being optional. Combining this with ARIN's RDAP allows you to determine the ISP returned in an easy to parse format (JSON). <br>

It is important to note that this method will only work if the host has internet access. Some organizations may build a block list of specific domains, so you should be 100% sure that this method will work for the organization you are attempting to leverage this against.</p>

<br>
<h3>Checking System Information</h3>

<br>
<h3>Querying Network Information</h3>



```
function test() {
  console.log("notice the blank line before this function?");
}
```


<pre><code>
$ sudo nmap -sV -sS [Target]


</code></pre>

<br>
<h2>Task 4. Implementing Various Evasion Techniques</h2>
<br>

<br>
<h2>Task 5. DIY Sandbox Evasion Challenge</h2>
<br>

<br>
<h2>Task 6. Wrapping Up</h2>
<br>
