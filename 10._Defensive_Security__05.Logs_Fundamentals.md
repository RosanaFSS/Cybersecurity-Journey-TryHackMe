<h3> Welcome to the <em>TryHackMe ...</em></h3>
<h1>Cyber Security 101 learning path > Defensive Security ></h1>
<h2>Logs Fundamentals</h2>
<p>Learn what logs are and how to analyze them for effective investigation.</p><br>
<p>October 26, 2024<br></p><br>

<div style="display: flex; justify-content: center; align-items: center;">
    <img src="https://github.com/user-attachments/assets/5bd77071-e8ae-4204-b47f-13c8f925a0b7" width="150px" height="150px"/>
</div>
<br>

![image](https://github.com/user-attachments/assets/9f3276aa-7dae-49c4-89be-36916e14bce8)


<p>Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure.<br>
It´s key part of my <strong>173</strong>-day-streak.<br><br>
Let´s get started!!<br><br>
Access this TryHackMe Room clicking <a href="https://tryhackme.com/r/room/logsfundamentals">Logs Fundamentals</a>.</p><br>

<h2>Task 1 - Introduction to Logs</h2>
<p>Attackers are clever. They avoid leaving maximum traces on the victim’s side to avoid detection. Yet, the security team successfully determines how the attack was executed and is even sometimes successful in finding who was behind the attack.<br>

Suppose a few policemen are investigating the disappearance of a precious locket in a snowy jungle cabin. They observed that the wooden door of the cabin was brutally damaged, and the ceiling collapsed. There were some footprints on the snowy path to that cabin. Lastly, they discovered some CCTV footage from a neighbouring residence. By placing together all these traces, the police successfully determined who was behind the attack. Various traces are found in several such cases; putting all these together takes you closer to the criminal.</p>

![image](https://github.com/user-attachments/assets/d80284a3-3dca-486b-bb07-b233b493d494)

<p>It seems like these traces play a big role in the investigations.<br>

What if something happened within a digital device? Where do we find all these traces to investigate further?<br>

There are various places inside a system where the traces of an attack could be fetched. The logs contain most of these traces. Logs are the digital footprints left behind by any activity. The activity could be a normal one or the one with malicious intent. Tracing down the activity and the individual behind the execution of that activity becomes easier through logs.</p>

![image](https://github.com/user-attachments/assets/e657a883-250b-4ae7-ad5d-0c77cb38251e)

<h3>Use Cases of Logs</h3>
<p>The following are some key areas in which the logs play an integral role.</p>

![image](https://github.com/user-attachments/assets/048c2ba2-2896-449c-8c31-1cd5a7fef4b8)

<p>This room will equip you with an understanding of various types of logs maintained in different systems. We will also be practically investigating logs as traces of different attacks.</p>

<h3>Learning Objectives</h3>
<ul style="list-style-type:square">
    <li>The different types of logs</li>
    <li>How to analyze logs</li>
    <li>Analyzing Windows Event logs</li>
    <li>Analyzing Web Access logs</li>  
</ul></p>

> 1.1 - <em>Where can we find the majority of attack traces in a digital system?</em>
>> <strong><code>Logs</code></strong>
<p></p><br>

<h2>Task 2 - Types of Logs</h2>
<br>

<p>In the previous task, we saw various use cases of logs. But there is a challenge. Imagine you have to investigate an issue in a system through the logs; you open the log file of that system, and now you are lost after seeing numerous events of different categories.<br>

Here is the solution: Logs are segregated into multiple categories according to the type of information they provide. So now you just need to look into the specific log file for which the issue relates.<br>

For example, you need to investigate the successful logins from yesterday at a specific timeframe in Windows OS. Instead of looking into all the logs, you only need to see the system’s Security Logs to find the login information. We also have other types of logs that are useful in investigating different incidents. Let’s have a look at them.</p>

![image](https://github.com/user-attachments/assets/1a71d7ee-2f66-4ee5-a599-affe50849287)

![image](https://github.com/user-attachments/assets/01b2a5c5-80ca-4b0a-a70d-cb5911f465b4)

<p><code>Note</code>: There can be various other types of logs depending on the different applications and the services they provide.<br>

Now that we understand what these logs are and how various types of logs can be helpful in different scenarios, let’s see how we analyze these logs and extract valuable information required from them. Log Analysis is a technique for extracting valuable data from logs. It involves looking for any signs of abnormal or unusual activities. Searching for a specific activity or abnormalities in the logs with the naked eye is impossible. For this reason, we have several manual and automated techniques for log analysis. We will manually carry out log analysis on Windows and Web Server Access Logs in the upcoming tasks.</p>

> 2.1 - <em>Which type of logs contain information regarding the incoming and outgoing traffic in the network?</em>
>> <strong><code>Network Logs</code></strong>
<p></p><br>

> 2.2 - <em>Is 1=1 in an SQL query always true? (YEA/NAY)</em>
>> <strong><code>Security Logs</code></strong>
<p></p><br>

<h2>Task 3 - Windows Event Logs Analysis</h2>
<br>

<p>Like other operating systems, Windows OS also logs many of the activities that take place. These are stored in segregated log files, each with a specific log category. Some of the crucial types of logs stored in a Windows Operating System are:</p>

<ul style="list-style-type:square">
    <li><code>Application</code>: There are many applications running on the operating system. Any information related to those applications is logged into this file. This information includes errors, warnings, compatibility issues, etc.</li>
    <li><code>System</code>: The operating system itself has different running operations. Any information related to these operations is logged in the System log file. This information includes driver issues, hardware issues, system startup and shutdown information, services information, etc.</li>
    <li><code>Security</code>: This is the most important log file in Windows OS in terms of security. It logs all security-related activities, including user authentication, changes in user accounts, security policy changes, etc.</li>
</ul>

<p>Besides these, several other log files in the Windows operating system are designed for logging activities related to specific actions and applications.<br>

Unlike other log files studied in the previous tasks, which had no built-in application to view them, Windows OS has a utility known as Event Viewer, which gives a nice graphical user interface to view and search for anything in these logs.<br>

To open Event Viewer, click on the Start button of Windows and type ‘Event Viewer’. It will open the Event Viewer for you, as shown below. The highlighted area in the screenshot below shows the different available logs. </p>

![image](https://tryhackme-images.s3.amazonaws.com/user-uploads/6645aa8c024f7893371eb7ac/room-content/6645aa8c024f7893371eb7ac-1719215860668)

<p>You can click ‘Windows Logs’ from the highlighted section to see the different types of logs we discussed at the beginning of this task. 
The first highlighted portion shows the different log files. When we click one of these log files, we will see the different logs, as can be seen in the second highlighted portion. Lastly, in the third highlighted portion, we have different options for analyzing the logs.</p>

![image](https://tryhackme-images.s3.amazonaws.com/user-uploads/6645aa8c024f7893371eb7ac/room-content/6645aa8c024f7893371eb7ac-1719215860882)

<p>Let’s double-click on one of these logs to see its contents. </p>

![image](https://tryhackme-images.s3.amazonaws.com/user-uploads/6645aa8c024f7893371eb7ac/room-content/6645aa8c024f7893371eb7ac-1719215860911)

<p>This is how a Windows event log looks. It has different fields. The major fields are discussed below:</p>

<ul style="list-style-type:square">
    <li><code>Description</code>: This field has a detailed information of the activity..</li>
    <li><code>Log Name</code>: The Log Name indicates the log file name..</li>
    <li><code>Logged</code>: This field indicates the time of the activity.</li>
    <li><code>Event ID</code>: Event IDs are unique identifiers for a specific activity..</li>
</ul>

<p>Numerous event IDs are available in Windows event logs. We can use these event IDs to search for any specific activity. For example, event ID 4624 uniquely identifies the activity of a successful login, so you only need to search for this event ID 4624 when investigating successful logins.<br>

Here is a table of some important Event IDs in Windows Operating System.</p>

![image](https://github.com/user-attachments/assets/2c628482-d9f6-420f-be0e-284fb2ab53f7)

<p>There are many more event IDs. It is not necessary to remember all of them, but it is good to remember the crucial event IDs.<br>

Event Viewer allows us to search for the logs related to a specific event ID with its ‘Filter Current Log’ feature. We can click on this feature to apply any filter. </p>

![Image](https://tryhackme-images.s3.amazonaws.com/user-uploads/6645aa8c024f7893371eb7ac/room-content/6645aa8c024f7893371eb7ac-1719215860856)

<p>When we click on the ‘Filter Current Log’ option, we will be prompted to enter the event IDs we want to filter. In the screenshot below, I filtered the event ID 4624. </p>

![Image](https://tryhackme-images.s3.amazonaws.com/user-uploads/6645aa8c024f7893371eb7ac/room-content/6645aa8c024f7893371eb7ac-1719215860786)

<p>Once I hit the 'OK' button, I can see all the logs with the event ID: 4624. I can now view any of these logs by double-clicking them. </p>

![Image](https://tryhackme-images.s3.amazonaws.com/user-uploads/6645aa8c024f7893371eb7ac/room-content/6645aa8c024f7893371eb7ac-1719215860652)

<h3>Exercise</h3>
<p>On Friday, a critical organization reported being a victim of a cyber attack. Upon investigation, critical data was exfiltrated from a file server in the organization’s network. The security team was successful in determining the user name and IP address of the compromised system in the network, which had access to the file server at the time of the attack.<br>

You are tasked to find out the activities of the attacker in this compromised system before he took access to the file server.<br>

First, let’s start the Virtual Machine by pressing the Start Machine button given below. The machine will start in Split-Screen view.</p>

<p>In case the VM is not visible, use the blue Show Split View button at the top of the page. The machine will open in GUI for you. You can also connect with the machine via VPN using the RDP credentials given below.
</p>

![image](https://github.com/user-attachments/assets/58dfe63d-03b1-405d-9e85-6222b7d936c2)

<p><code>Note</code>: All the questions below can be answered by looking into the logs.</p>

> 3.1 - <em>What is the name of the last user account created on this system?</em>
>> <strong><code>_</code></strong>
<p></p><br>

> 3.2 - <em>Which user account created the above account?</em>
>> <strong><code>_</code></strong>
<p></p><br>

> 3.3 - <em>What is the name of the last user account created on this system?</em>
>> <strong><code>_</code></strong>
<p></p><br>

> 3.3 - <em>On what date was this user account enabled? Format: M/D/YYYY</em>
>> <strong><code>_</code></strong>
<p></p><br>

> 3.4 - <em>Did this account undergo a password reset as well? Format: Yes/No?</em>
>> <strong><code>_</code></strong>
<p></p><br>


<h2>Task 4 - Use Case: Directory and File Enumeration</h2>
<br>

<p>In this task, we've attached a vulnerable web application for you to test SQL injection vulnerabilities. Let's start the Virtual Machine by pressing the Start Machine button given below. The machine will start, and an IP address will be displayed to you. You can now open the attack box by clicking the Start AttackBox button at the top. The AttackBox will open for you in the split view. You will use this machine to carry out SQL injection through the SQLMap tool.</p>

<p>Note: It is highly recommended to use the AttackBox for this task.</p>

<p>The web application has a login page that is hosted at http://10.10.198.123/ai/login. When you visit this URL, you will see a login page that is vulnerable to SQL injection.</p>

![image](https://github.com/user-attachments/assets/476e2742-a414-4cc4-af5f-76ed5d5d665d)

<p>In the previous task, we saw that if we see GET parameters in the URL, they might be vulnerable to SQL injection, and we can copy that URL to use it with SQLMap. We also saw that if there is a POST request and the data is sent inside the body rather than the URL, we can intercept the request and use it with the SQLMap tool to exploit a SQL injection vulnerability, if there is any.<br>

However, in this task, on the login page, we have used the GET requests, but the parameters of this request are not visible in the URL as they were on the previous task's website. To test the URL with SQLMap, we need to have the URL along with the GET parameters.<br>

So, to get the complete URL along with its GET parameters, we need to right-click on the login page and click the inspect option (the process may vary slightly from browser to browser). From here, we have to select the Network tab; then we have to enter some test credentials in the username and password fields and click the login button, and we will be able to see the GET request. Click on that request, and we can see the complete GET request with the parameters. We can copy this complete URL and use it with the SQLMap tool to discover SQL injection vulnerabilities inside it and exploit it. The complete request is shown in the screenshot below:</p>

![image](https://github.com/user-attachments/assets/ac9be323-6a76-48ad-a179-e4ea4787f348)

<p>Note: If you are unable to extract the URL by the above process, you can copy it from below:

<code>http://10.10.198.123/ai/includes/user_login?email=test&password=test</code>

Run the commands as discussed in the previous task on this URL and answer the questions given in this task. Also, remember to include your URL inside single quotes <code>'</code>. This is to avoid errors with special characters in the terminal such as <code>?</code>.

<code>Important Note</code>: You may not get the results by the simple scan; add <code>--level=5</code> at the end of your commands to perform the in-depth scans. Secondly, while running the commands, the tool may ask you some questions; make sure to respond to them as follows to run the scan smoothly:</p>

<ul style="list-style-type:square">
    <li>It looks like the back-end DBMS is 'MySQL'. Do you want to skip test payloads specific for other DBMSes? [Y/n]: <code>y</code></li>
    <li>For the remaining tests, do you want to include all tests for 'MySQL' extending provided risk (1) value? [Y/n]: <code>y</code></li>
    <li>Injection not exploitable with NULL values. Do you want to try with a random integer value for option '--union-char'? [Y/n]: <code>y</code></li>
    <li>GET parameter 'email' is vulnerable. Do you want to keep testing the others (if any)? [y/N]: <code>n</code></li>
</ul></p>

> 4.1 - <em>How many databases are available in this web application?</em>
>> <strong><code>6</code></strong>
<p></p><br>

![image](https://github.com/user-attachments/assets/2ad1c814-d85f-41b5-b03a-bece55e5d15e)

<br>

![image](https://github.com/user-attachments/assets/59be5d20-00bd-4a92-b949-7d05d7aee5c7)

<br>

![image](https://github.com/user-attachments/assets/65d70d3d-47d4-483f-b07d-87216725367c)

<br>

![image](https://github.com/user-attachments/assets/ae594fee-82b2-44a8-811b-927fc2aa90c6)

<br>

<pre><code>$ root@ip-[REDACTED]:~#  sqlmap -u "http://[REDACTED]/ai/includes/user_login?email=rosana@local.com&password=test" --level=5 --dbs</code></pre>

<br>

![image](https://github.com/user-attachments/assets/76da0dab-e357-4460-b8ba-6a2906c2152a)

<br>

![image](https://github.com/user-attachments/assets/c7aa2e6b-6bea-4dcf-975d-3885af1723b9)

<br>

> 4.2 - <em>What is the name of the table available in the "ai" database?</em>
>> <strong><code>user</code></strong>
<p></p><br>

<pre><code>$ root@ip-[REDACTED]:~# sqlmap -u "http://[REDACTED]/ai/includes/user_login?email=rosana@local.com&password=test" --level=5 -D ai --tables
</code></pre>

<br>

![image](https://github.com/user-attachments/assets/21ac99cc-6c38-461b-844c-348f829e5892)

<br>

> 4.3 - <em>What is the password of the email test@chatai.com??</em>
>> <strong><code>12345678</code></strong>
<p></p><br>

<pre><code>$ root@ip-[REDACTED]:~# sqlmap -u "http://[REDACTED]/ai/includes/user_login?email=rosana@local.com&password=test" --level=5 -D ai --tables --dump</code></pre>

![image](https://github.com/user-attachments/assets/881ea143-d1a9-4118-b73f-1636da15253b)


<pre><code>$ root@ip-[REDACTED]:~# sudo nano /etc/systemd/resolved.conf
</code></pre>

<pre><code>$ # You can change settings by editing this file.
# Defaults can be restored by simply deleting this file.
#
# See resolved.conf(5) for details
[Resolve]
DNS=[REDACTED]
#FallbackDNS=
</code></pre>
<br>
<h2>Task 3 - Gobuster: Introduction</h2>
<br>


<h2>Room Complete</h2>
<br>
<p>Keep learning, keep growing!<br>

![image](https://github.com/user-attachments/assets/54367b3f-e695-4c8d-9251-f4882e9965dd)


<h2>My journey</h2>
<br>
<p></p>Following I share the status of my journey in TryHackMe.</p>

![image](https://github.com/user-attachments/assets/54f10d6e-eaca-4fde-b84d-061c80a48a3a)

<p></p>

<p style="text-align: center;">Thank you for coming. Hope to learn together again!!</p>
