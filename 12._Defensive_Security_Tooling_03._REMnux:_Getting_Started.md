<h3> Welcome to the <em>TryHackMe ...</em></h3>
<h1>Cyber Security 101 learning path > Defensive Security Tooling ></h1 >
<h2>REMux: Getting Started</h2>
<p>Learn how you can use the tools inside the REMnux VM.</p><br>
<p>October 27, 2024<br></p>


<div style="display: flex; justify-content: center; align-items: center;">
    <img src="https://github.com/user-attachments/assets/6b18232f-1f01-4901-be83-c931c7bad8d2" width="150px" height="150px"/>
</div>
<br>

![image](https://github.com/user-attachments/assets/45f24831-de4d-48f0-9fda-3824ee4bcdfa)



<p>Hey there, fellow lifelong learner! I´m <a href="https://www.linkedin.com/in/rosanafssantos/">Rosana</a>, and I’m genuinely excited to join you on this adventure. It´s key part of my 174-day-streak.<br>Let´s get started!!<br><br>
Access this TryHackMe Room clicking <a href="https://tryhackme.com/r/room/remnuxgettingstarted">REMux: Getting Started</a>.</p>

<h2>Task 1 - Introduction</h2>
<p>Analysing potentially malicious software can be daunting, especially when this is part of an ongoing security incident. This analysis puts much pressure on the analyst. Most of the time, the results must be as accurate as possible, and analysts use different tools, machines, and environments to achieve this. In this room, we will use the REMnux VM.</p>

![image](https://github.com/user-attachments/assets/aef40e11-ffbb-46a5-aec2-5476ad3bfc65)


<p>The REMnux VM is a specialised Linux distro. It already includes tools like Volatility, YARA, Wireshark, oledump, and INetSim. It also provides a sandbox-like environment for dissecting potentially malicious software without risking your primary system. It's your lab set up and ready to go without the hassle of manual installations.</p>

<h3>Learning Objectives</h3>
<ul style="list-style-type:square">
    <li>Explore the tools inside the REMnux VM</li>
    <li>Learn how to use tools to analyse potentially malicious documents effectively</li>
    <li>Learn how to simulate a fake network to aid in the analysis</li>
    <li>Be familiar with the tools used to analyse memory images</li>
</ul>

<h3>Room Prerequisites</h3>
<p>Familiarity with the CyberChef tool is recommended but not mandatory before starting the course. You can check the room associated with it.</p>
<ul style="list-style-type:square">
    <li><a href="https://tryhackme.com/jr/cyberchefbasics">CyberChef: The Basics</a></li>
</ul>

> 1.1 - <em>Proceed with the next tasks to learn more!</em><br>
>> <strong>No answer needed</strong><br>
<p><br></p>


<h2>Task 2 - Machine Access</h2>

<p>We will use the AttackBox and the attached virtual machine in this room. To start the REMnux virtual machine, click the green Start Machine button below.</p>

<p>... Start Machine button</p>

<p>The machine will start in a split-screen view and might take 2-3 minutes to boot up. It is expected to have the an output similar to the image below.</p>

![image](https://github.com/user-attachments/assets/44e7ba0a-4428-4292-8ea3-2e9c2e9e9cb8)

<br>
<p>If the machine does not appear, click the blue Show Split View button at the top of the page.<br>

Please note that almost all the files we will use in this room are located in the <code>Desktop/tasks</code> directory.</p>

> 2.1 - <em>I'm excited to learn more about the tools inside the REMnux VM!</em><br>
>> <strong>No answer needed</strong><br>
<p><br></p>

<pre><code>ubuntu@ip-[REDACTED]:~/Desktop/tasks/agenttesla$ oledump.py agenttesla.xlsm
</code></pre>

![image](https://github.com/user-attachments/assets/fce7c794-1d55-4e12-9537-d74bca95d665)

<br>

<h2>Task 3 - File Analysis</h2>

<p>In this task, we will use oledump.py to conduct static analysis on a potentially malicious Excel document.<br>

Oledump.py is a Python tool that analyzes OLE2 files, commonly called Structured Storage or Compound File Binary Format. OLE stands for Object Linking and Embedding, a proprietary technology developed by Microsoft. OLE2 files are typically used to store multiple data types, such as documents, spreadsheets, and presentations, within a single file. This tool is handy for extracting and examining the contents of OLE2 files, making it a valuable resource for forensic analysis and malware detection.<br>

Let's start!<br>

Using the virtual machine attached to task 2, the REMnux VM, navigate to the /home/ubuntu/Desktop/tasks/agenttesla/ directory. Our target file is named agenttelsa.xlsm. Run the command oledump.py agenttesla.xlsm. See the terminal below.</p>

![image](https://github.com/user-attachments/assets/cc6d3312-60a0-4ea9-999c-919d1c57f7a1)

<br>

![image](https://github.com/user-attachments/assets/cae71872-a7b9-4090-a827-2917327c7113)

<p>Based on OleDump's file analysis, a VBA script might be embedded in the document and found inside xl/vbaProject.bin. Therefore, oledump will assign this with an index of A, though this can sometimes differ. The A (index) +Numbers are called data streams.<br>

Now, we should be aware of the data stream with the capital letter M. This means there is a Macro, and you might want to check out this data stream, 'VBA/ThisWorkbook'.<br>

So, let's check it out! Let's run the command oledump.py agenttesla.xlsm -s 4. This command will run the oledump and look into the actual data stream of interest using the parameter -s 4,  wherein the -s parameter is short for -select  and the number four(4) as the data stream of interest is in the 4th place(A4: M 688 'VBA/ThisWorkbook')</p>

![image](https://github.com/user-attachments/assets/3602da7f-557c-4a24-a75e-e2f00eeb7cab)

<br>

![image](https://github.com/user-attachments/assets/2a2d1d2c-2e01-48ac-b8d6-bb42814ad266)


<br>

![image](https://github.com/user-attachments/assets/246451ea-b554-420f-aa50-35bba5911305)

<br>
<p>The results above are in hex dump format. There might be some familiar words from a trained eye. However, this is still challenging for us, don't you think? So, let's make it more readable and easier to understand.<br>

We will run an additional parameter --vbadecompress in addition to the previous command. When we use this parameter, oledump will automatically decompress any compressed VBA macros it finds into a more readable format, making it easier to analyze the contents of the macros.</p>

![image](https://github.com/user-attachments/assets/2305e8ed-fe50-4051-b6c9-5f8eb664a9ce)

![image](https://github.com/user-attachments/assets/0279f8e6-e489-4db1-b10e-4706ec6aecf0)


<p>This is much better, isn't it?<br>
 Now, we don't need to be able to read the whole script but rather familiarize ourselves with some characters and commands. Our interest here would be the value of Sqtnew because if you check the script, there is a Public IP, a PDF, and a .exe inside. We might want to look into this further.</p>

 ![image](https://github.com/user-attachments/assets/c0500fce-689a-4116-afa9-fbbea993a409)

 <p>We will copy the first value of Sqtnew and paste it into CyberChef's input area. You can open a local copy of CyberChef inside the REMnux VM or go to this link to access the online version. Use whichever works for you. You might want to check our room about CyberChef to get more familiar with the tool.<br>

Next, select the Find/Replace operation twice. Looking back at the script, the 2nd and 3rd values of Sqtnew have a command to replace * with "" and ^ with "". We would assume that the "" means there is no value. So, with our first operation selected, we put the value * and selected SIMPLE STRING as additional parameters. In contrast, we did not put anything on the Replace box or have any value.  The same applies to our second operation: we put the value ^ and selected SIMPLE STRING, and the replace box has no value. See the image below.</p>

![image](https://github.com/user-attachments/assets/a1ea60d5-fc15-4187-bce7-c20d86e6dd0c)

<p>Now, this is more readable! However, for our starters, this can be challenging. So, we will tackle the most basic commands here.</p>

![image](https://github.com/user-attachments/assets/e442d746-4efd-48a9-aa46-83d1371ea5ed)

<p>Let's break it down!<br>

So, in PowerShell, running the -WindowStyle parameter allows you to control how the PowerShell window appears when executing a script or command. In this case, hidden means that the PowerShell window won’t be visible to the user.<br>
By default, PowerShell restricts script execution for security reasons. The -executionpolicy parameter allows you to override this policy. The bypass means that the execution policy is temporarily ignored, allowing any script to run without restriction.<br>
The Invoke-WebRequest is commonly used for downloading files from the internet.<br>
The -Uri Specifies the URL of the web resource you want to retrieve. In our case, the script is downloading the resource Doc-3737122pdf.exe from http://193.203.203.67/rt/.<br>
The -OutFile specifies the local file where the downloaded content will be saved.  In this case, the Doc-3737122pdf.exe will be saved to $TempFile.<br>
The Start-Process is used to execute the downloaded file that is stored in $TempFile after the web request.<br>
To summarize, when the document agenttesla.xlsm is opened, a Macro will run! This Macro contains a VBA script. The script will run and will be running a PowerShell to download a file named Doc-3737122pdf.exe from http://193.203.203.67/rt/, save it to a variable $TempFile, then execute or start running the file inside this variable, which is a binary or a .exe file (Doc-3737122pdf.exe). This is a usual technique used by threat actors to avoid early detection. Pretty nasty, right?!<br>

Kudos to you for figuring it out!</p>




 




